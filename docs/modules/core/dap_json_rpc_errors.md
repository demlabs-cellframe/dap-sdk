# DAP JSON-RPC Errors (–û—à–∏–±–∫–∏ JSON-RPC)

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `dap_json_rpc_errors` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏ –¥–ª—è JSON-RPC –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –≤ DAP SDK. –†–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π JSON-RPC 2.0.

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

JSON-RPC –ø—Ä–æ—Ç–æ–∫–æ–ª —Ç—Ä–µ–±—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è:
- **–ù–∞–¥–µ–∂–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏** –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞** —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫** –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —è–∑—ã–∫–æ–≤
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏** —Å–µ—Ç–µ–≤—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏** —Å JSON-RPC 2.0 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìã **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫**
- –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –∫–æ–¥–∞–º–∏
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º

### üîÑ **JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –≤ JSON —Ñ–æ—Ä–º–∞—Ç
- –ü–∞—Ä—Å–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∏–∑ JSON –æ–±—ä–µ–∫—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤ –æ—à–∏–±–æ–∫

### üìù **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è**
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

### üîç **–ü–æ–∏—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
- –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø–æ –∫–æ–¥–∞–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π –æ—à–∏–±–æ–∫
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏

```c
#define DAP_JSON_RPC_ERR_CODE_MEMORY_ALLOCATED 1
// –û—à–∏–±–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

#define DAP_JSON_RPC_ERR_CODE_SERIALIZATION_SIGN_TO_JSON 2
// –û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏ –≤ JSON

#define DAP_JSON_RPC_ERR_CODE_SERIALIZATION_DATUM_TO_JSON 3
// –û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ datum –≤ JSON

#define DAP_JSON_RPC_ERR_CODE_SERIALIZATION_ADDR_TO_JSON 4
// –û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–∞ –≤ JSON
```

### –î–∏–∞–ø–∞–∑–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

```c
#define DAP_JSON_RPC_ERR_CODE_METHOD_ERR_START 11
// –ù–∞—á–∞–ª–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –º–µ—Ç–æ–¥–æ–≤
```

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—à–∏–±–∫–∏

```c
typedef struct dap_json_rpc_error {
    int code_error;    // –ö–æ–¥ –æ—à–∏–±–∫–∏
    char *msg;         // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    void *next;        // –°–ª–µ–¥—É—é—â–∞—è –æ—à–∏–±–∫–∞ –≤ —Å–ø–∏—Å–∫–µ (–¥–ª—è UTlist)
} dap_json_rpc_error_t;
```

### JSON –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏

```c
typedef struct dap_json_rpc_error_JSON {
    json_object *obj_code;  // JSON –æ–±—ä–µ–∫—Ç —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏
    json_object *obj_msg;   // JSON –æ–±—ä–µ–∫—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
} dap_json_rpc_error_JSON_t;
```

## API –§—É–Ω–∫—Ü–∏–∏

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```c
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –æ—à–∏–±–æ–∫
int dap_json_rpc_error_init(void);

// –î–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –æ—à–∏–±–æ–∫
void dap_json_rpc_error_deinit(void);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
void dap_json_rpc_add_standart_erros(void);
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JSON –æ–±—ä–µ–∫—Ç–∞–º–∏

```c
// –°–æ–∑–¥–∞–Ω–∏–µ JSON –æ–±—ä–µ–∫—Ç–∞ –æ—à–∏–±–∫–∏
dap_json_rpc_error_JSON_t *dap_json_rpc_error_JSON_create();

// –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ JSON –æ–±—ä–µ–∫—Ç–∞ –æ—à–∏–±–∫–∏
void dap_json_rpc_error_JSON_free(dap_json_rpc_error_JSON_t *a_error_json);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ JSON –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏
dap_json_rpc_error_JSON_t *dap_json_rpc_error_JSON_add_data(int code, const char *msg);
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –æ—Ç–≤–µ—Ç

```c
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ JSON –º–∞—Å—Å–∏–≤ –æ—Ç–≤–µ—Ç–∞
int dap_json_rpc_error_add(json_object* a_json_arr_reply, int a_code_error, const char *msg, ...);
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

```c
// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –≤ –≤–∏–¥–µ JSON –æ–±—ä–µ–∫—Ç–∞
json_object *dap_json_rpc_error_get();

// –ü–æ–∏—Å–∫ –æ—à–∏–±–∫–∏ –ø–æ –∫–æ–¥—É
dap_json_rpc_error_t *dap_json_rpc_error_search_by_code(int a_code_error);

// –ü–æ–ª—É—á–µ–Ω–∏–µ JSON –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—à–∏–±–∫–∏
json_object *dap_json_rpc_error_get_json(dap_json_rpc_error_t *a_error);

// –ü–æ–ª—É—á–µ–Ω–∏–µ JSON —Å—Ç—Ä–æ–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—à–∏–±–∫–∏
char *dap_json_rpc_error_get_json_str(dap_json_rpc_error_t *a_error);
```

### –ü–∞—Ä—Å–∏–Ω–≥ –æ—à–∏–±–æ–∫

```c
// –°–æ–∑–¥–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–∑ JSON —Å—Ç—Ä–æ–∫–∏
dap_json_rpc_error_t *dap_json_rpc_create_from_json(const char *a_json);

// –°–æ–∑–¥–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–∑ JSON –æ–±—ä–µ–∫—Ç–∞
dap_json_rpc_error_t *dap_json_rpc_create_from_json_object(json_object *a_jobj);
```

## –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã

### –ú–∞–∫—Ä–æ—Å –¥–ª—è –æ—à–∏–±–æ–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

```c
#define dap_json_rpc_allocation_error(a_json_arr_reply) \
    do { \
        log_it(L_CRITICAL, "%s", c_error_memory_alloc); \
        dap_json_rpc_error_add(a_json_arr_reply, \
                              DAP_JSON_RPC_ERR_CODE_MEMORY_ALLOCATED, \
                              "[%s] %s", LOG_TAG, c_error_memory_alloc); \
    } while (0)
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```c
#include "dap_json_rpc_errors.h"

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
if (dap_json_rpc_error_init() != 0) {
    fprintf(stderr, "Failed to initialize JSON-RPC errors\n");
    return -1;
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
dap_json_rpc_add_standart_erros();
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ JSON-RPC –æ—Ç–≤–µ—Ç

```c
// –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –¥–ª—è –æ—à–∏–±–æ–∫
json_object *json_response = json_object_new_array();

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
dap_json_rpc_allocation_error(json_response);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –æ—à–∏–±–∫–∏
dap_json_rpc_error_add(json_response,
                      1001,
                      "Invalid parameter: %s",
                      "wallet_address");

// –ü–æ–ª—É—á–µ–Ω–∏–µ JSON —Å—Ç—Ä–æ–∫–∏ –æ—Ç–≤–µ—Ç–∞
const char *response_str = json_object_to_json_string(json_response);
send_response(client_socket, response_str);

// –û—á–∏—Å—Ç–∫–∞
json_object_put(json_response);
```

### –ü–∞—Ä—Å–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞

```c
// –ü–æ–ª—É—á–µ–Ω–∏–µ JSON –æ—à–∏–±–∫–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
const char *error_json = receive_error_from_client();

// –ü–∞—Ä—Å–∏–Ω–≥ –æ—à–∏–±–∫–∏
dap_json_rpc_error_t *parsed_error = dap_json_rpc_create_from_json(error_json);
if (parsed_error) {
    printf("Received error: code=%d, message=%s\n",
           parsed_error->code_error, parsed_error->msg);

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–¥–∞ –æ—à–∏–±–∫–∏
    switch (parsed_error->code_error) {
        case DAP_JSON_RPC_ERR_CODE_MEMORY_ALLOCATED:
            handle_memory_error();
            break;
        case 1001:
            handle_invalid_parameter();
            break;
        default:
            handle_unknown_error(parsed_error);
            break;
    }

    // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
    free(parsed_error->msg);
    free(parsed_error);
}
```

### –ü–æ–∏—Å–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—à–∏–±–æ–∫

```c
// –ü–æ–∏—Å–∫ –æ—à–∏–±–∫–∏ –ø–æ –∫–æ–¥—É
dap_json_rpc_error_t *error_info = dap_json_rpc_error_search_by_code(1001);
if (error_info) {
    printf("Error found: %s\n", error_info->msg);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –æ—à–∏–±–∫–∏
bool is_valid_error_code(int error_code) {
    return dap_json_rpc_error_search_by_code(error_code) != NULL;
}
```

## –§–æ—Ä–º–∞—Ç JSON –æ—à–∏–±–æ–∫

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON-RPC –æ—à–∏–±–∫–∏

```json
{
  "jsonrpc": "2.0",
  "error": {
    "code": 1001,
    "message": "Invalid parameter: wallet_address",
    "data": {
      "additional_info": "Detailed error description"
    }
  },
  "id": null
}
```

### –ú–∞—Å—Å–∏–≤ –æ—à–∏–±–æ–∫

```json
{
  "jsonrpc": "2.0",
  "errors": [
    {
      "code": 1,
      "message": "Memory allocation failed"
    },
    {
      "code": 1001,
      "message": "Invalid wallet address format"
    }
  ],
  "id": 123
}
```

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏ (-32768 –¥–æ -32000)

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| -32700 | Parse error (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON) |
| -32600 | Invalid Request (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞) |
| -32601 | Method not found |
| -32602 | Invalid params |
| -32603 | Internal error |

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ (-32099 –¥–æ -32000)

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| -32000 | Server error |
| -32001 | Authentication failed |
| -32002 | Permission denied |

### –ü—Ä–∏–∫–ª–∞–¥–Ω—ã–µ –æ—à–∏–±–∫–∏ (1 –∏ –≤—ã—à–µ)

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 1 | Memory allocation error |
| 2 | Serialization error |
| 3 | Datum serialization error |
| 4 | Address serialization error |
| 11+ | User-defined errors |

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è**: –í—Å–µ –æ—à–∏–±–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- **UTlist**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UTlist –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ**: –§—É–Ω–∫—Ü–∏–∏ –≤—ã–¥–µ–ª—è—é—Ç –ø–∞–º—è—Ç—å –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ**: –ü–∞–º—è—Ç—å –¥–æ–ª–∂–Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å—Å—è –≤—ã–∑—ã–≤–∞—é—â–∏–º –∫–æ–¥–æ–º
- **JSON –æ–±—ä–µ–∫—Ç—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–º —Å—Å—ã–ª–æ–∫

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫**: O(n) –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É –æ—à–∏–±–∫–∏ (n –æ–±—ã—á–Ω–æ –º–∞–ª–æ)
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- **–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ DAP SDK

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫

```c
// –í —Å–µ—Ç–µ–≤–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ JSON-RPC
json_object *process_json_rpc_request(const char *request_json) {
    json_object *response = json_object_new_object();

    // –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞
    json_object *request = json_tokener_parse(request_json);
    if (!request) {
        // –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
        json_object *error_array = json_object_new_array();
        dap_json_rpc_error_add(error_array, -32700, "Parse error");
        json_object_object_add(response, "error", error_array);
        return response;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...
    // –ü—Ä–∏ –æ—à–∏–±–∫–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—Ç–≤–µ—Ç
    if (processing_failed) {
        json_object *error_array = json_object_new_array();
        dap_json_rpc_error_add(error_array, 1001, "Processing failed: %s", error_details);
        json_object_object_add(response, "error", error_array);
    }

    json_object_put(request);
    return response;
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

```c
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
void log_json_rpc_error(dap_json_rpc_error_t *error) {
    if (!error) return;

    // –ü–æ–ª—É—á–µ–Ω–∏–µ JSON –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    char *error_json = dap_json_rpc_error_get_json_str(error);
    log_it(L_ERROR, "JSON-RPC Error: %s", error_json);
    free(error_json);
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```c
// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–µ—Ç–æ–¥–∞
bool validate_wallet_params(json_object *params, json_object *error_array) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if (!json_object_object_get(params, "wallet_address")) {
        dap_json_rpc_error_add(error_array, -32602,
                              "Missing required parameter: wallet_address");
        return false;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∞–¥—Ä–µ—Å–∞
    const char *address = json_object_get_string(
        json_object_object_get(params, "wallet_address"));

    if (!is_valid_wallet_address(address)) {
        dap_json_rpc_error_add(error_array, 1001,
                              "Invalid wallet address format: %s", address);
        return false;
    }

    return true;
}
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

- `dap_common.h` - –û–±—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ –º–∞–∫—Ä–æ—Å—ã
- `dap_strfuncs.h` - –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `json.h` - JSON –ø–∞—Ä—Å–∏–Ω–≥ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (libjson)
- `utlist.h` - –ú–∞–∫—Ä–æ—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–≤—è–∑–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏

## –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```c
// –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
dap_json_rpc_error_t *create_error_from_json_safe(const char *json_str) {
    if (!json_str || strlen(json_str) == 0) {
        return NULL;
    }

    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ JSON —Å—Ç—Ä–æ–∫–∏
    if (strlen(json_str) > MAX_JSON_SIZE) {
        log_it(L_WARNING, "JSON string too large: %zu bytes", strlen(json_str));
        return NULL;
    }

    return dap_json_rpc_create_from_json(json_str);
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

```c
// –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
void cleanup_json_rpc_error(dap_json_rpc_error_t *error) {
    if (!error) return;

    if (error->msg) {
        free(error->msg);
    }
    free(error);
}

// –î–ª—è JSON –æ–±—ä–µ–∫—Ç–æ–≤
json_object *response = json_object_new_object();
// ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ...
json_object_put(response); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

```c
// –ò–∑–±–µ–≥–∞–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
dap_json_rpc_error_add(error_array, 1002, "Authentication failed");
// –ù–ï –î–ï–õ–ê–¢–¨: "Authentication failed for user: %s", username
```

## –û—Ç–ª–∞–¥–∫–∞

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫

```c
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –æ—à–∏–±–∫–∏
void debug_json_rpc_error(dap_json_rpc_error_t *error) {
    if (!error) {
        printf("Error: NULL\n");
        return;
    }

    printf("JSON-RPC Error:\n");
    printf("  Code: %d\n", error->code_error);
    printf("  Message: %s\n", error->msg ? error->msg : "NULL");

    // –ü–æ–ª—É—á–µ–Ω–∏–µ JSON –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
    char *json_str = dap_json_rpc_error_get_json_str(error);
    printf("  JSON: %s\n", json_str);
    free(json_str);
}

// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
void test_error_handling() {
    // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ—à–∏–±–∫–∏
    json_object *error_array = json_object_new_array();
    dap_json_rpc_error_add(error_array, 1001, "Test error");

    // –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞
    const char *json_str = json_object_to_json_string(error_array);
    dap_json_rpc_error_t *parsed = dap_json_rpc_create_from_json(json_str);

    debug_json_rpc_error(parsed);

    // –û—á–∏—Å—Ç–∫–∞
    if (parsed) {
        free(parsed->msg);
        free(parsed);
    }
    json_object_put(error_array);
}
```

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ JSON-RPC –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è—Ö DAP SDK, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—è —Å–æ–∑–¥–∞–Ω–∏—é –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏ –æ—Ç–ª–∞–∂–∏–≤–∞–µ–º—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

